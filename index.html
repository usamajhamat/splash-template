<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="keywords" content="WiFi, Guest Access, Captive Portal" />
  <meta name="description" content="Guest WiFi Access Portal" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <link rel="shortcut icon" type="image/png" href="favicon.png" />

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .content {
      max-width: 400px;
      width: 90%;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      text-align: center;
      padding: 20px;
    }

    .body h1 {
      color: #2c3e50;
      font-size: 24px;
      margin: 10px 0;
    }

    .body h3 {
      color: #7f8c8d;
      font-size: 16px;
      font-weight: normal;
      margin: 10px 0 20px;
    }

    .footer {
      padding: 20px 0;
    }

    .button {
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease;
      width: 100%;
      max-width: 200px;
    }

    .button:hover {
      background: #2980b9;
    }

    @media (max-width: 480px) {
      .content {
        margin: 20px;
      }

      .body h1 {
        font-size: 20px;
      }

      .body h3 {
        font-size: 14px;
      }
    }
  </style>

  <title>Guest WiFi Portal</title>

  <script type="text/javascript">
    function getParameterByName(name, url = window.location.href) {
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return "";
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    function buildLoginURL() {
      const apIP = getParameterByName("ap_ip");
      const apPort = getParameterByName("ap_port");
      if (!apIP || !apPort) {
        console.error("Missing ap_ip or ap_port");
        return null;
      }
      return `http://${apIP}/captive/grant/`;
    }

    window.onload = function () {
      const loginURL = buildLoginURL();
      if (loginURL) {
        document.loginForm.action = loginURL;
        const successURL = getParameterByName("user_url") || "https://www.google.com";
        document.getElementById("successURLInput").value = successURL;
      } else {
        alert("Error: Unable to construct login URL. Please check AP configuration.");
      }
    };
  </script>
</head>
<body>
  <div class="content">
    <div class="body">
      <h1>Welcome to Guest WiFi</h1>
      <h3>Click below to connect to the internet</h3>
    </div>
    <div class="footer">
      <form name="loginForm" method="post">
        <input id="successURLInput" type="hidden" name="success_url" />
        <input type="hidden" name="username" value="guest" />
        <input type="hidden" name="password" value="guest" />
        <button type="submit" class="button">Connect Now</button>
      </form>
    </div>
  </div>
</body>
</html>
